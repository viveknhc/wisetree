<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GSAP + Lenis Scroll</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
        }

        section {
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
        }

        .box {
            width: 100px;
            height: 100px;
            background: crimson;
        }
    </style>
</head>

<body>
    <section style="background: #f0f0f0;">Section 1</section>
    <section style="background: #e0e0e0;">
        <div class="box" data-speed="5">Speed 2</div>
        <div class="box" data-speed="0.5">Speed 0.5</div>
    </section>
    <section style="background: #d0d0d0;">Section 3</section>

    <!-- Scripts -->
    <script src="https://unpkg.com/gsap@3/dist/gsap.min.js"></script>
    <script src="https://unpkg.com/gsap@3/dist/ScrollTrigger.min.js"></script>
    <script src="https://unpkg.com/@studio-freight/lenis@1.0.19/bundled/lenis.min.js"></script>

    <script>
        // Init Lenis
        const lenis = new Lenis({
            smooth: true
        });

        function raf(time) {
            lenis.raf(time);
            requestAnimationFrame(raf);
        }

        requestAnimationFrame(raf);

        // Sync GSAP ScrollTrigger with Lenis
        gsap.registerPlugin(ScrollTrigger);

        lenis.on('scroll', ScrollTrigger.update);

        ScrollTrigger.scrollerProxy(document.body, {
            scrollTop(value) {
                return arguments.length ? lenis.scrollTo(value) : lenis.scroll;
            },
            getBoundingClientRect() {
                return { top: 0, left: 0, width: window.innerWidth, height: window.innerHeight };
            },
            pinType: document.body.style.transform ? "transform" : "fixed"
        });

        // Example GSAP animation
        gsap.utils.toArray(".box").forEach((el) => {
            let speed = parseFloat(el.dataset.speed) || 1;

            gsap.to(el, {
                x: 100 * speed, // or whatever value makes sense for you
                rotation: 360 * speed,
                ease: "none",
                scrollTrigger: {
                    trigger: el,
                    start: 'top bottom',
                    end: 'bottom top',
                    scrub: true,
                    markers: true
                }
            });
        });

        ScrollTrigger.addEventListener('refresh', () => lenis.update());
        ScrollTrigger.refresh();
    </script>
</body>

</html>